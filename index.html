<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <title>replace the title</title>
</head>
<body>
<div class="container-fluid">
    <!-- 1 -->
    <div class="row">
        <div class="col-12 text-center bg-info">
            <h2>SignUp</h2>
        </div>
    </div>

    <!-- The form -->
    <div class="row">
        <div class="col-4"></div>
        <div class="col-12 col-lg-4">
            <form class="row g-3" method="post" action="#">
                <div class="col-12 col-md-6 prev-clicked">
                    <label for="First-Name" class="form-label">First name</label>
                    <input type="text" class="form-control" id="First-Name">
                    <div class="good-val-fu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-fu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 col-md-6 prev-clicked">
                    <label for="Last-Name" class="form-label">Last name</label>
                    <input type="text" class="form-control" id="Last-Name">
                    <div class="good-val-lu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-lu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 prev-clicked">
                    <label for="Email" class="form-label">Email</label>
                    <div class="input-group">
                        <span class="input-group-text">@</span>
                        <input type="text" class="form-control" id="Email" aria-describedby="inputGroupPrepend">
                    </div>
                    <div class="good-val-eu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-eu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 col-md-6 d-none next-clicked">
                    <label for="Password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="Password">
                    <div class="good-val-pu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-pu alert alert-danger d-none"></div>
                </div>
                <div class="vol-12 col-md-6 d-none next-clicked">
                    <label for="Valid-Password" class="form-label">Valid Password</label>
                    <input type="password" class="form-control" id="Valid-Password">
                    <div class="good-val-vpu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-vpu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 col-md-6 d-none next-clicked">
                    <label for="Date-Of-Birth" class="form-label">Date Of Birth</label>
                    <input type="date" class="form-control" id="Date-Of-Birth">
                    <div class="good-val-du alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-du alert alert-danger d-none"></div>
                </div>
                <div class="col-12 col-md-6 d-none next-clicked">
                    <label for="Gender" class="form-label">Gender</label>
                    <select class="form-select" aria-label="Default select example" id="Gender">
                        <option selected>Select your gender</option>
                        <option value="1">Male</option>
                        <option value="2">Female</option>
                        <option value="3">Other</option>
                    </select>
                    <div class="good-val-gu alert alert-success d-none">Looks good!</div>
                    <div class="bad-val-gu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 d-none next-clicked">
                    <div class="input-group">
                        <span class="input-group-text">Comments</span>
                        <textarea class="form-control Comments-elem" aria-label="Comments"></textarea>
                    </div>
                    <div class="bad-val-cu alert alert-danger d-none"></div>
                </div>
                <div class="col-12 text-center">
                    <button class="btn btn-primary go-prev next-clicked d-none" type="button">Back</button>
                    <button class="btn btn-primary sub-next" type="button">Next</button>
                </div>
            </form>
        </div>
        <div class="col-4"></div>
    </div>

    <!-- SignUp -->
    <div class="row">
        <div class="col-12 text-center no-exist-u">
            <p>no user exist</p>
        </div>
        <div class="col-12 text-center d-none exist-u">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">First name</th>
                    <th scope="col">Last name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Password</th>
                    <th scope="col">Date Of Birth</th>
                    <th scope="col">Gender</th>
                    <th scope="col">comments</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const PAGE_1 = 0;
    let emails = {};
    let page_num = 0;
    const genders = ["Male", "Female", "Other"];

    const funcs = {
        alert_message(bad_lable, good_lable, message, is_bad)
        {
            let name_alert = document.querySelector(bad_lable);
            name_alert.innerHTML = message;

            if (is_bad)
            {
                name_alert.classList.remove("d-none")
                if(good_lable !== "") {
                    name_alert = document.querySelector(good_lable);
                    name_alert.classList.add("d-none")
                }
            }
            else
            {
                name_alert.classList.add("d-none")
                if(good_lable !== "") {
                    name_alert = document.querySelector(good_lable);
                    name_alert.classList.remove("d-none")
                }
            }
        },

        prev_click(elem_prev_none, elem_next_none, sub_next) {
            elem_prev_none.forEach(div => {
                div.classList.remove('d-none');
            });

            elem_next_none.forEach(div => {
                div.classList.add('d-none');
            });

            sub_next.classList.remove("btn-success")
            sub_next.classList.add("btn-primary")

            --page_num;
            sub_next.innerHTML = "Next";
        },

        next_click(elem_prev_none, elem_next_none, sub_next) {
            elem_next_none.forEach(div => {
                div.classList.remove('d-none');
            });

            elem_prev_none.forEach(div => {
                div.classList.add('d-none');
            });

            sub_next.innerHTML = "Submit";
            sub_next.classList.remove("btn-primary")
            sub_next.classList.add("btn-success")
            ++page_num;
        },

        reset_alerts()
        {
            const alerts_bunners = document.querySelectorAll('div .alert');

            alerts_bunners.forEach(alert =>{
                alert.classList.add('d-none');
            })
        }
    }

    document.addEventListener('DOMContentLoaded', function(){

        const az_pattern = /^[a-z]+\s*$/;
        const email_pattern = /\S+@\S+ac\.il/;
        const password_pattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}$/;

        const elem_next_none = document.querySelectorAll('div .next-clicked');
        const elem_prev_none = document.querySelectorAll('div .prev-clicked');

        const sub_next = document.querySelector("div .sub-next");



        sub_next.addEventListener("click", function(){
            let first_name_ev = document.getElementById("First-Name");
            let last_name_ev = document.getElementById("Last-Name");
            let email_ev = document.getElementById("Email");

            let is_valid = true;
            console.log(emails.length)
            if (page_num === PAGE_1)
            {
                // first name validation
                if(!first_name_ev.value.trim()) {
                    funcs.alert_message(".bad-val-fu", ".good-val-fu", "The first name must not be empty", true);
                    is_valid = false;
                } else if(!az_pattern.test(first_name_ev.value.trim())) {
                    funcs.alert_message(".bad-val-fu", ".good-val-fu", "The first name should only contain alphabets (a-z)", true);
                    is_valid = false;
                }
                else {
                    funcs.alert_message(".bad-val-fu", ".good-val-fu", "", false);
                }

                // last name validation
                if(!last_name_ev.value.trim()) {
                    funcs.alert_message(".bad-val-lu", ".good-val-lu", "The last name must not be empty", true);
                    is_valid = false;
                } else if(!az_pattern.test(last_name_ev.value.trim())) {
                    funcs.alert_message(".bad-val-lu", ".good-val-lu", "The last name should only contain alphabets (a-z)", true);
                    is_valid = false;
                } else {
                    funcs.alert_message(".bad-val-lu", ".good-val-lu", "", false);
                }

                //email validation
                if(!email_ev.value.trim()) {
                    funcs.alert_message(".bad-val-eu", ".good-val-eu", "The Email must not be empty", true);
                    is_valid = false;
                } else if(email_ev.value.trim() in emails) {
                    funcs.alert_message(".bad-val-eu", ".good-val-eu", "The Email should be unique, one cannot record more than one user with same email.", true);
                    is_valid = false;
                } else if(!email_pattern.test(email_ev.value.trim())) {
                    funcs.alert_message(".bad-val-eu", ".good-val-eu", "The Email should contain a valid email address from an Israeli academic institution (*.ac.il)", true);
                    is_valid = false;
                } else {
                    funcs.alert_message(".bad-val-eu", ".good-val-eu", "", false);
                }

                if(is_valid)
                    funcs.next_click(elem_prev_none, elem_next_none, sub_next);
            }
            else
            {
                const password_ev = document.getElementById("Password");
                const confirm_password_ev = document.getElementById("Valid-Password");
                const date_ev = document.getElementById("Date-Of-Birth");
                const gender_ev = document.getElementById("Gender");
                const text_ev = document.querySelector("textarea");

                // password validation
                if(!password_ev.value.trim()) {
                    funcs.alert_message(".bad-val-pu", ".good-val-pu", "The password must not be empty", true);
                    is_valid = false;

                    document.querySelector(".good-val-vpu").classList.add('d-none');
                    document.querySelector(".bad-val-vpu").classList.add('d-none');
                } else if(!password_pattern.test(password_ev.value.trim())) {
                    let add_length = ""
                    if(password_ev.value.trim().length<8)
                        add_length = " <b>minimum eight characters<b>";

                    funcs.alert_message(".bad-val-pu", ".good-val-pu", "The password should only contain at least one uppercase letter(A-Z), one lowercase letter (a-z) and one digit."+add_length, true);
                    is_valid = false;

                    document.querySelector(".good-val-vpu").classList.add('d-none');
                    document.querySelector(".bad-val-vpu").classList.add('d-none');
                } else if(password_ev.value.trim().length<8) {
                    funcs.alert_message(".bad-val-pu", ".good-val-pu", "<b>minimum eight characters<b>", true);
                    is_valid = false;

                    document.querySelector(".good-val-vpu").classList.add('d-none');
                    document.querySelector(".bad-val-vpu").classList.add('d-none');
                } else {
                    funcs.alert_message(".bad-val-pu", ".good-val-pu", "", false);

                    // valid password validation
                    if(!confirm_password_ev.value.trim()) {
                        funcs.alert_message(".bad-val-vpu", ".good-val-vpu", "The Valid password must not be empty", true);
                        is_valid = false;
                    } else if(confirm_password_ev.value.trim() !== password_ev.value.trim()) {
                        funcs.alert_message(".bad-val-vpu", ".good-val-vpu", "The Valid password must match the first password field", true);
                        is_valid = false;
                    } else {
                        funcs.alert_message(".bad-val-vpu", ".good-val-vpu", "", false);
                    }
                }

                // date validation
                console.log(date_ev.value.trim())
                if(!date_ev.value.trim()) {
                    funcs.alert_message(".bad-val-du", ".good-val-du", "The date must not be empty", true);
                    is_valid = false;
                } else {
                    const dateObject = new Date(date_ev.value.trim()); // make date value
                    if (!isNaN(dateObject.getTime())/*check if the date input is valid*/)
                    {
                        const currentDate = new Date();
                        const userBirthDate = new Date(dateObject.getFullYear() + 18, dateObject.getMonth(), dateObject.getDate());

                        if (userBirthDate > currentDate)
                        {
                            funcs.alert_message(".bad-val-du", ".good-val-du", "The user date must be at least 18 years old", true);
                            is_valid = false
                        } else {
                            funcs.alert_message(".bad-val-du", ".good-val-du", "", false);
                        }
                    } else {
                        funcs.alert_message(".bad-val-du", ".good-val-du", "the date input is not valid", true);
                        is_valid = false
                    }
                }

                // gender validation
                if(gender_ev.selectedIndex === 0) {
                    funcs.alert_message(".bad-val-gu", ".good-val-gu", "You must to choose your Gender!", true);
                    is_valid = false;
                } else {
                    funcs.alert_message(".bad-val-gu", ".good-val-gu", "", false);
                }

                if(text_ev.value.trim().length > 100) {
                    funcs.alert_message(".bad-val-cu", "", "maximum of 100 characters", true);
                    is_valid = false;
                } else {
                    funcs.alert_message(".bad-val-cu", "", "", false);
                }

                if(is_valid)
                {
                    document.querySelector(".no-exist-u").classList.add("d-none");
                    document.querySelector(".exist-u").classList.remove("d-none");
                    emails[email_ev.value.trim()] = {
                        first_name: first_name_ev.value.trim(),
                        last_name: last_name_ev.value.trim(),
                        password: password_ev.value.trim(),
                        date: date_ev.value.trim(),
                        gender: genders[gender_ev.value.trim()-1],
                        text: text_ev.value.trim(),
                    };

                    email_ev.value = "";
                    first_name_ev.value = "";
                    last_name_ev.value = "";
                    password_ev.value = "";
                    confirm_password_ev.value = "";
                    date_ev.value = "";
                    gender_ev.selectedIndex = 0;
                    text_ev.value = "";

                    funcs.prev_click(elem_prev_none, elem_next_none);
                    funcs.reset_alerts();

                    // sort the emails object
                    const sortedKeys = Object.keys(emails).sort();
                    const sortedObject = {};
                    sortedKeys.forEach(key => {
                        sortedObject[key] = emails[key];
                    });
                    emails = sortedObject;
                    //===============================

                    let new_scope = "";
                    let list = 0;
                    for (const user in emails){
                        new_scope += "<tr>\n" +
                            "                    <th scope=\"row\">"+(++list).toString()+"</th>\n" +
                            "                    <td>"+emails[user].first_name+"</td>\n" +
                            "                    <td>"+emails[user].last_name+"</td>\n" +
                            "                    <td>"+user+"</td>\n" +
                            "                    <td>"+emails[user].password+"</td>\n" +
                            "                    <td>"+emails[user].date+"</td>\n" +
                            "                    <td>"+emails[user].gender+"</td>\n" +
                            "                    <td>"+emails[user].text+"</td>\n" +
                            "                </tr>";
                    }
                    document.querySelector("tbody").innerHTML = new_scope
                }
            }
        })

        document.querySelector(".go-prev").addEventListener("click", function(){
            funcs.prev_click(elem_prev_none, elem_next_none, sub_next);
        })
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
</body>
</html>